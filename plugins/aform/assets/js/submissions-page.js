!function(e){function t(e,t){var a={};for(var s in e)a[s]=e[s];for(var s in t)a[s]=t[s];return a}function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}var s=new Paginathor;s.updateSettings({elClass:"submission-page",target:"#"});var i={},n=e("#deleteDialog");n.dialog({autoOpen:!1,closeOnEscape:!0,dialogClass:"wp-dialog",minHeight:80,modal:!0});var r={results:e("#formSubmissionResults"),pages:e(".form-result-pagination"),rebuildPages:!0,currentQuery:{},reuseQuery:!1,setup:function(){e.ajaxSetup({url:ajaxurl,type:"post"})},classToggle:function(){this.results.toggleClass("ajax-active")},deleteSubmission:function(){var t=e(".delete-submission");t.on("click",function(t){t.preventDefault();var a=e(this),s=a.data("deleteSubmission"),i=a.parents("tr");n.dialog({buttons:{"Don't Delete":function(){e(this).dialog("close")},Delete:function(){e.ajax({data:{action:"deleteSubmission",id:s}}).done(function(t){t=JSON.parse(t),i.fadeOut("500",function(){e(this).remove()}),n.dialog("close")})}}}),n.dialog("open")})},getSubmissions:function(a,n,o,l,u){var d=r.reuseQuery;if(defaultObj={action:"formSubmissions"},0==d){var m=e("#formCount option:selected"),l=l?l:m.val(),u=u?u:1;mergedData={fieldID:a,from:n,to:o,limit:l,page:u}}else mergedData=r.currentQuery;mergedData=t(defaultObj,mergedData),r.currentQuery=mergedData,e.ajax({beforeSend:this.classToggle(),complete:this.classToggle(),data:mergedData}).done(function(t){if(i={},0!=t.success){var l=r.results.find("tbody"),u=r.pages.find("ul");if(r.rebuildPages&&u.html(""),l.html(""),results=JSON.parse(t.data),""!=results.results){if(r.rebuildPages){_fieldID=a?a:"",_from=n?n:"",_to=o?o:"";var d=jQuery.extend(!0,{},r.currentQuery);if(delete d.page,d.limit=!1,d.action="downloads_fs",d.datafor="filtered",downloadQuery=e.param(d),downloadurl=ajaxurl+"?"+downloadQuery,e("a#downloadFs").attr("href",downloadurl).removeAttr("style"),!r.reuseQuery){var m=e("#defaultSort");m.hasClass("selected")||(e(".form-sort-control").find(".selected").toggleClass("selected"),m.addClass("selected"))}}if(results.pages>0){var f=r.currentQuery,p=results.results.length,g={page:f.page,results:p,total:parseInt(results.total)};u.html("");var h={page:f.page,total:results.total,limit:f.limit},v=s.build(h);setTimeout(function(){u.html(v)},300);var b=setInterval(function(){u[0].childElementCount>0&&(u.find(".submission-page").on("click",function(t){t.preventDefault();var a=e(this),s=a.data("submissionPage");r.reuseQuery=!0,r.currentQuery.page=s,r.getSubmissions()}),console.info(g),clearInterval(b))},150)}c=1,e.each(results.results,function(){this.form_data=JSON.parse(this.form_data);var t="",a="<tr><td>"+this.post_title+"</td>";a+="<td>"+this.date_time+"</td>",a+="<td>"+this.email+"</td>","submissionmeta"in this&&(t=e('<div><span class="meta-info"></span></div>'),submissionMeta=this.submissionmeta,this.form_data.meta=submissionMeta,e.each(submissionMeta,function(){var e=this;"tracking"==e.meta_type&&"campaign"==e.meta_key&&t.find("span").append('<i class="sf-sm-info info-campaign-tracking">CT</i>')})),a+='<td><a class="data-link" data-formdata="submission-'+this.id+'">View Form Data'+(""!=t?t.html():"")+"</a></td>",a+='<td><a><span data-delete-submission="'+this.id+'" class="delete-submission dashicons dashicons-trash"></span></a></td></tr>',l.append(a),i["submission-"+this.id]=this.form_data,p>0&&c==p&&r.deleteSubmission(),c+=1}),r.reuseQuery=!1}}})}};r.setup(),r.getSubmissions();var o=e("#filterSubmit"),l=(e("#submissionsFilter"),e("#filterReset")),u=e("#formName"),d=e("#fromDate"),m=e("#toDate"),f=e("#formCount");e("#submissionsFilter :input").change(function(){e("a#downloadFs").hide()}),o.on("click",function(e){e.preventDefault();var t,a=u.val();null!=a&&a.forEach(function(e){void 0==t?t=e:t+=", "+e}),r.rebuildPages=!0,r.getSubmissions(t,d.val(),m.val(),f.val())}),l.on("click",function(e){e.preventDefault(),u.find("option:selected").prop("selected",!1),d.add(m).val(""),f.val(10),r.getSubmissions()});var p=e(".orderby");p.on("click",function(a){a.preventDefault();var s=e(this),i=r.currentQuery,n=s.data("orderby"),o={},l="selected";p.removeClass(l),s.addClass(l),i.page=1,o.orderby=n,i=t(i,o),r.reuseQuery=!0,r.rebuildPages=!0,r.currentQuery=i,r.getSubmissions()}),e("#formSubmissionResults").on("click",".data-link",function(t){var a=e(this).data("formdata");a=i[a];var s=g(a);e.fancybox(["<div>"+s+"</div>"],{arrows:!1,autoSize:!1,height:"65%",margin:[20,20,20,180],width:"80%"})});var g=function(t){var s=t.form,i=t.fields,n="<div><h2><center>Form &raquo; "+s.sfname+"</center></h2>";return"submission-page"in s&&(n+='<p><strong style="display:inline-block;width:150px;">Submitted From Page:</strong>'+s["submission-page"]+"</p>"),"http_referrer"in s&&(n+='<p><strong style="display:inline-block;width:150px;">Submitted From URL:</strong>'+s.http_referrer+"</p>"),"client_ip"in s&&(n+='<p><strong style="display:inline-block;width:150px;">Submitted From IP:</strong>'+s.client_ip+"</p>"),n+="<h3>Form Data</h3>",e.each(i,function(e,t){n+="<p><strong>"+t.display+"</strong>: "+t.value+"</p>"}),"meta"in t&&e.each(t.meta,function(){var t=this;meta_value="","tracking"==t.meta_type&&"campaign"==t.meta_key&&(meta_value=JSON.parse(t.meta_value),n+="<h3><strong>Campaign Tracking</strong></h3>",e.each(meta_value,function(e,t){n+='<span><strong style="display:inline-block;width:125px;">'+a(e)+":</strong> "+t+"</span><br>"}))}),n+="</div>"};e(".date-picker").datepicker()}(jQuery);