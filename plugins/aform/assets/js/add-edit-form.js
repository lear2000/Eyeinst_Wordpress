function whichTransitionEvent(){var e,i=document.createElement("fakeelement"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(void 0!==i.style[e])return t[e]}function whichAnimationEvent(){var e,i=document.createElement("fakeelement"),t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in t)if(void 0!==i.style[e])return t[e]}Array.max=function(e){return Math.max.apply(Math,e)};var animationEvent=whichAnimationEvent(),transitionEvent=whichTransitionEvent();!function(e){function i(e){e.draggable({appendTo:"body",helper:"clone",cursor:"move",connectToSortable:"#fieldDropzone",drag:function(e,i){},start:function(e,i){f.addClass("droppable-active")},stop:function(e,i){f.removeClass("droppable-active")}})}function t(i){var t=e('input[name*="'+i+'"]');if(0==t.length)return!1;var n=t.filter(":checked");n.length>0?t.filter(":not(:checked)").prop("disabled",!0):t.filter(":not(:checked)").prop("disabled",!1)}function n(){u.on("change",'input[name*="use_choicelabel_as_value"]',function(){var i=e(this),t=i.parents(".form--field");1==i[0].checked?(t.find(".is-label-optional").html("required"),t.find(".is-label-optional-input").attr("required","required"),t.find(".input-values").attr("data-label-optional",1)):(t.find(".is-label-optional").html("optional"),t.find(".is-label-optional-input").removeAttr("required"),t.find(".input-values").attr("data-label-optional",0))})}function a(i,t){var n=e(i).parent(),a=e(i).parents(".af-toggle-grouped");if(a.length>0)var l=a.find("."+t);else var l=n.siblings("."+t);l.slideToggle(400)}function l(){e(".duplicate-field").unbind("click"),e(".duplicate-field").on("click",function(t){t.preventDefault();var n=e(this),a=n.parents(".form--field"),l=e(":input",a),o=a.attr("id");y.dialog({appendTo:"#"+o,buttons:{Cancel:function(){e(this).find(":input").removeAttr("style"),e(this).dialog("close")},Create:function(){var t=e(this).find(":input");""==t.val()?t.css({border:"1px solid red"}):(myModal=e(this),l=l.serialize(),t.removeAttr("style"),myModal.find(".clonename-wrap").hide(),myModal.find("p").show(),myModal.parent().find(".ui-dialog-buttonpane").hide(),myModal.parent().find("button.ui-dialog-titlebar-close").hide(),setTimeout(function(){r.createDuplicateField(l,t.val(),function(t){t=JSON.parse(t),myModal.find(":input").val("");var n=e(t.html).addClass("new--reusable").hide();i(n),e(".available-reusablefields").append(n),setTimeout(function(){myModal.find(".clonename-wrap").removeAttr("style"),myModal.parent().find(".ui-dialog-buttonpane").removeAttr("style"),myModal.parent().find("button.ui-dialog-titlebar-close").removeAttr("style"),myModal.find("p").hide(),myModal.dialog("close"),myModal.dialog("close"),myModal.dialog({appendTo:"body"}),e(".available-reusablefields").find(".new--reusable").slideDown("slow",function(){e(this).removeClass("new--reusable")})},750)})},750))}}}),y.dialog("open")})}function o(){if(s)return"The changes you made will be lost if you navigate away from this page."}var s=!1,d={},r={formFields:e("#formFields"),setup:function(){e.ajaxSetup({url:ajaxurl,type:"post"})},classToggle:function(){u.toggleClass("ajax-active")},createDuplicateField:function(i,t,n){e.ajax({data:{action:"afAjaxSwitch",method:"cloneField",fields:i,fieldlabel:t}}).done(function(e){n=n||null,null!=n?n.call(this,e):console.log(e)})},fieldDrop:function(i,a,o,d,r){var u=e(".form--field").length;r=r||!1,e.ajax({beforeSend:this.classToggle,complete:this.classToggle,data:{action:"afAjaxSwitch",method:"newFormField",field:i,fieldcount:a,aformPost:o,reusableID:r}}).done(function(i){var i=e(i),o=f.find(".submit-field");i.one(animationEvent,function(e){i.removeClass("new-fieldstart")}),i.addClass("new-fieldstart"),o.length>0?e(d).prev().hasClass("submit-field")?(e(d).remove(),o.before(i)):a>0?e(d).replaceWith(i):(e(d).remove(),o.before(i)):e(d).replaceWith(i);var r=e(".form--field:not(.submit-field)").last(),p=r.find(".input-values");p.sortable({handle:".handle",items:"> div:not(.submit-field)"}),t("for_admin_email"),t("primary_email_recipient"),t("use_as_confirmation_subject"),t("conditional_confirmation"),n(),setTimeout(function(){var t=e(".form--field");if(u<t.length){var n=t;n.each(function(n){e(this).find(".aform-input-order").val(n),e(this).attr("data-index",n),n+1==t.length&&(i.slideDown("500",function(){}),c.create(),l())})}},250),s=!0})},newInputValue:function(i,t,n,a,l){a=a||null,e.ajax({beforeSend:this.classToggle,complete:this.classToggle,data:{action:"afAjaxSwitch",method:"createChoice",index:t,count:n,option:a,inputtype:l}}).done(function(e){i.append(e)})},deleteField:function(i,t,n){n=n||null,e.ajax({beforeSend:this.classToggle,complete:this.classToggle,data:{action:"afAjaxSwitch",method:"deleteFormField",fieldID:i}}).done(function(e){null!=n?(n.call(this,e),s=!0):(t.remove(),s=!0)})},deleteReusableField:function(i,t){t=t||null,e.ajax({data:{action:"afAjaxSwitch",method:"deleteFormField",fieldID:i,t:"reusablefields"}}).done(function(e){null!=t&&t.call(this,e)})}},c={maxsize:200,parentWrap:".filesize-slider-wrap",maxFileSizeInputs:"input.max-filesize-input",spanMaxFileSizeInputs:"span.max-filesize-input",filesizeSlider:".filesize-slider",setup:function(e){var i=this,e=e?e:i.maxsize;return i.maxsize=e,i.create().liveSlide(),i},create:function(){var i=this,t=i.maxsize;return e(i.filesizeSlider).not(".ui-slider").slider({range:"max",value:1,min:1,max:t,create:function(t,n){var a=e(this),l=a.parents(i.parentWrap).find(i.maxFileSizeInputs).val();a.slider("value",l)}}),i},liveSlide:function(){var i=this;return e(i.filesizeSlider).on("slide",function(t,n){e(this).parent().find(i.maxFileSizeInputs).val(n.value),e(this).parent().find(i.spanMaxFileSizeInputs).html(n.value)}),i}};r.setup(),c.setup();var f=e("#fieldDropzone"),u=e("#formFields"),p=e("#submitField"),m=e(".add--field"),h=(p.find("input"),p.find('input[name*="input_order"]'));i(m),f.sortable({containment:"parent",handle:".handle",items:" > div:not(.submit-field)",opacity:.7,receive:function(i,t){e(t.helper).css({opacity:"0.25",width:"100%"}),setTimeout(function(){var i,n=f.children(".form--field"),a=t.helper.data("reusableId")||!1,l=t.helper.data("fieldType"),o=[0];n.each(function(i,t){var n=e(t).find('input[name*="input_order"]').val();o.push(n)}),o.sort(function(e,i){return i-e}),i=o[0],r.fieldDrop(l,i,aformPost,replaceItem=t.helper,a),p.length>0&&setTimeout(function(){var e=parseInt(i)+1;h.val(e)},200)},200)},stop:function(i,t){if(e(t.item).hasClass("form--field")){var n=e(this).find(".form--field");n.each(function(i){e(this).find(".aform-input-order").val(i),e(this).attr("data-index",i)})}},tolerance:"pointer"}).droppable({});var v=u.find(".input-values");v.sortable({handle:".handle",items:"div"}),u.on("click",".add-input-value",function(i){i.preventDefault();var t=e(this),n=t.siblings(".input-values"),a=t.parents(".form--field").find(".aform-field-id").val(),l=n.find("div").length,o=t.parents(".form--field"),s=o.find(".apply-conditional-conf"),d=o.data("inputType"),c="";s.prop("checked")&&(c="conditional_confirmation");var f=o.find(".input-values");1==f.attr("data-label-optional")&&(c="label_is_required"),r.newInputValue(n,a,l,c,d)}),u.on("click",".apply-conditional-conf",function(i){var t=e(this),n=t.parents(".form--field");t.prop("checked")?n.find(".conditional-confirmation-launch").removeAttr("style"):n.find(".conditional-confirmation-launch").hide()});var g=!0;u.on("click",".conditional-confirmation-launch",function(i){if(i.preventDefault(),1==g){var t=e(this);parents=t.parents(".field-tab"),parent=t.parent(),base=parents.parent(),text=parent.find("textarea").val(),subject=parent.find(".cond-conf-subject").val(),parent.addClass("now-editing"),parents.addClass("now-editing"),fieldID=base.find(".field-id-ref").data("fieldRefId"),e.ajax({data:{action:"afAjaxSwitch",method:"renderWPField",field:"wysiwyg",id:fieldID}}).done(function(e){parents.find(".wysiwig-wrapper .content-box").append(e),setTimeout(function(){parents.find(".wysiwig-wrapper").slideDown("400",function(){var e=parents.find(".wysiwig-wrapper").find("textarea").attr("id");quicktags({id:e,buttons:"",disabled_buttons:""}),QTags._buttonsInit(),parents.find(".wysiwig-wrapper").find("textarea").val(text),parents.find(".wysiwig-wrapper").find(".custom-subject-line-temp").val(subject)})},500)})}g=!1}),u.on("click",".close-content",function(i){i.preventDefault();var t=e(this),n=t.parents(".wysiwig-wrapper");parents=t.parents(".field-tab"),n.slideUp("400",function(){g=!0,n.find(".content-box").html(""),n.find(".custom-subject-line-temp").val(""),parents.find(".now-editing").removeClass("now-editing"),parents.removeClass("now-editing")})}),u.on("click",".apply-content",function(i){i.preventDefault();var t=e(this);parent=t.parents(".wysiwig-wrapper"),parents=t.parents(".field-tab"),wpeditor=parent.find("textarea").val(),subject=parent.find(".custom-subject-line-temp"),parents.find(".now-editing").find("textarea").html(wpeditor),parents.find(".now-editing").find(".cond-conf-subject").val(subject.val()),setTimeout(function(){parent.slideUp("400",function(){g=!0,parent.find(".content-box").html(""),subject.val(""),parents.find(".now-editing").removeClass("now-editing"),parents.removeClass("now-editing")})},1e3)}),u.on("click",".field-create-tabs button",function(i){if(i.preventDefault(),$this=e(this),!$this.hasClass("selected")){var t=$this.parents(".field-create");t.find(".field-tab.selected").removeClass("selected"),$this.siblings(".selected").removeClass("selected"),$this.addClass("selected"),t.find("#fieldCreate"+$this.data("tab")).addClass("selected")}}),u.on("click",".adv-toggle-tab a",function(i){i.preventDefault();var t=e(this).parents(".toggle-tab");t.toggleClass("active"),e(this).parents(".form--field").toggleClass("edit-mode"),e("body").toggleClass("edit-mode-on")}),u.on("click",".toggle-choices a",function(i){i.preventDefault();var t=e(this).parents(".toggle-tab");t.toggleClass("active");var n=t.next(".field-tab");n.slideToggle()}),u.on("click",".close-field-wrapper a",function(i){i.preventDefault();var t=e(this);t.parents(".form--field").find(".adv-toggle-tab a").trigger("click")});var b=e("#deleteDialog");b.dialog({autoOpen:!1,closeOnEscape:!0,dialogClass:"wp-dialog",minHeight:80,modal:!0}),u.on("click",".delete-field",function(i){i.preventDefault();var a=e(this),l=a.parents(".form--field"),o=l.find("input.aform-field-id").val();b.dialog({buttons:{"Don't Delete":function(){e(this).dialog("close")},Delete:function(){r.deleteField(o,l,function(i){l.slideUp("slow",function(){e(this).remove(),t("for_admin_email"),t("primary_email_recipient"),t("use_as_confirmation_subject"),t("conditional_confirmation"),n()})}),e(this).dialog("close")}}}),b.dialog("open")}),u.on("click",".delete-value",function(i){console.log("loggy");var t=e(this).parent("div");b.dialog({buttons:{"Don't Delete":function(){e(this).dialog("close")},Delete:function(){t.remove(),e(this).dialog("close")}}}),b.dialog("open")});var w;u.on("keyup",".value-bind",function(){var i=e(this),t=e(this).parents(".value-bind-parent");clearTimeout(w),w=setTimeout(function(){1==i.data("uglify")?(valueSet=t.find(".value-set"),valueSet.val(i.val().toLowerCase()),valueSetClean=valueSet.val().replace(/\?|<|>|\.|,|\/|{|}|\[|\]|=|\+|\*|\&|\^|\%|\$|\#|\@|\!|\(|\)|\_|\`|\~/g,""),valueSetClean=valueSetClean.replace(/\s/g,"-"),valueSet.val(valueSetClean)):t.find(".value-set").val(i.val())},150)}),u.on("keyup",".value-set",function(){e(this).val()!=e(this).siblings(".value-bind").val()&&(e(this).removeClass("value-set"),e(this).parents(".field-create-basic").find(".value-bind").removeClass("value-bind"))}),u.on("change",'input[name*="for_admin_email"]',function(){t("for_admin_email")}),u.on("change",'input[name*="primary_email_recipient"]',function(){t("primary_email_recipient")}),u.on("change",'input[name*="use_as_confirmation_subject"]',function(){t("use_as_confirmation_subject")}),u.on("change",'input[name*="conditional_confirmation"]',function(){t("conditional_confirmation")}),t("for_admin_email"),t("primary_email_recipient"),t("use_as_confirmation_subject"),t("conditional_confirmation"),n(),u.on("change",".enabler",function(){a(this,e(this).data("target"))}),e("#formsettings").on("change",".enabler",function(){a(this,e(this).data("target"))}),u.on("change",".html5_type_options",function(){var i=e(this),t=e("option:selected",e(this)),n=t.attr("value");"date"==n?(i.parents(".field-tab").find(".dateValidationFormat").show(),i.parents(".field-tab").find(".html5RangeOptions").hide()):"range"==n?(i.parents(".field-tab").find(".dateValidationFormat").hide(),i.parents(".field-tab").find(".html5RangeOptions").show()):(i.parents(".field-tab").find(".html5RangeOptions").hide(),i.parents(".field-tab").find(".dateValidationFormat").hide())});var y=e("#reusableFieldBox");y.dialog({autoOpen:!1,closeOnEscape:!1,width:390,minHeight:80,modal:!0}),l(),e("#reusablefields").on("click",".delete-reusable-field",function(i){i.preventDefault();var t=e(this),n=t.data("removeReusable")||!1;parent=t.parents(".add--field"),b.dialog({buttons:{"Don't Delete":function(){e(this).dialog("close")},Delete:function(){var i=e(this);d.deleteReusable={},parent.css({opacity:"0.5"}),r.deleteReusableField(n,function(e){setTimeout(function(){d.deleteReusable=e},1500)});var t=setInterval(function(){d.deleteReusable.hasOwnProperty("success")&&(1==d.deleteReusable.success?parent.slideUp("slow",function(i){e(this).remove()}):parent.css({opacity:"1"}),delete d.deleteReusable,clearInterval(t))},200);i.dialog("close")}}}),b.dialog("open")}),e("ul#formTabs li a").on("click",function(i){i.preventDefault();var t=e(this),n=t.parents("#formTabs"),a=n.data("tabfor"),l=t.attr("href");n.find("li").removeClass("selected"),t.parent("li").addClass("selected"),e(a).hide(),e(l).show()}),e("ul#formTabs li").first().find("a").trigger("click"),e(".afsc-input input").on("keydown",function(i){var t=i.keyCode||i.which;return 13==t?(e("#afsc a.afsc-close").trigger("click"),!1):void(9==t&&e("#afsc a.afsc-close").trigger("click"))}),e("#afsc a.afsc-edit").on("click",function(i){i.preventDefault();var t=e(this);t.addClass("hidden"),t.parents("#afsc").find(".afsc-name").addClass("hidden"),t.parents("#afsc").find(".afsc-input").removeClass("hidden"),t.parents("#afsc").find(".afsc-close").removeClass("hidden"),e("#shortcodeUpdateDialog").dialog({modal:!0,position:{my:"center top",at:"center bottom",of:e("#afsc")},buttons:{Ok:function(){e(this).dialog("close")}}})}),e("#fieldDropzone").on("click",".choicesfromstring",function(i){i.preventDefault();var t=e(this),n=t.data("fieldid"),a=t.parents(".field-tab").find(".holds-choices"),l=a.children("div").length,o=[];l>0&&a.children("div").each(function(i,t){t=e(t),o.push(t.data("currentindex")),l==i+1&&(l=Array.max(o),l+=2)}),e("#createChoicesDialog").dialog({title:"Bulk Create From String",minWidth:450,modal:!0,buttons:{Cancel:function(){e(this).dialog("close")},Create:function(){var i=e(this),t=e(this).find("textarea"),o=t.val();""!=o&&(dialogbuttons=i.next(),dialogbuttons.hide(),e.ajax({data:{action:"afAjaxSwitch",method:"createChoicesFromString",fieldId:n,choices:o,count:l+2}}).done(function(e){e=JSON.parse(e),"html"in e?(a.append(e.html),t.val(""),dialogbuttons.show(),i.dialog("destroy")):(dialogbuttons.show(),i.dialog("close"),alert("something went wrong :("))}))}}})}),e("#formsettings").on("blur","input#admin_email_from",function(i){var t=e("#conf_email_address").val(),n=e(this),a=n.val();""==e.trim(t)&&""!=e.trim(a)&&e("#conf_email_address").val(a)}),e("#afsc a.afsc-close").on("click",function(i){var t=e(this);e.post(ajaxurl,{action:"sample-permalink",post_id:e("#post_ID").val(),new_slug:t.parents("#afsc").find("input").val(),new_title:e("#title").val(),samplepermalinknonce:e("#samplepermalinknonce").val()},function(i){e(".permalink-ph").html(i);var n=e(".permalink-ph").find("#editable-post-name-full").html();t.parents("#afsc").find(".afsc-name .post_name").html(n),t.parents("#afsc").find(".afsc-input input").val(n),t.parents("#afsc").find(".afsc-name").removeClass("hidden"),t.parents("#afsc").find(".afsc-input").addClass("hidden"),t.parents("#afsc").find(".afsc-edit").removeClass("hidden"),t.addClass("hidden")})});var _='<div style="display:none;"><div id="emptyFieldsDialog" style="text-align:center;">';_+="Oops!<br>Not much of a form if there's no fields<br>:)",_+="</div></div>",e("body").append(_),e("#emptyFieldsDialog").dialog({autoOpen:!1,closeOnEscape:!1,minHeight:80,modal:!0,position:{my:"center",at:"top+150",of:window}}),e("form#post").on("submit",function(){var i=e(".field--dropzone").find(".form--field");return 0==i.length?(e("#emptyFieldsDialog").dialog("open"),!1):void(s=!1)}),window.onbeforeunload=o}(jQuery);